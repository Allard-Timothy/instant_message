import socket, threading, time, msvcrt

print "Fill in the following"
url_inpt = raw_input("URL: ")
port_input = raw_input("Port: ")
print "Starting IIM client on port: " + _port

socketOut = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
socketOut.connect((_url, int(_port)))



print "Enter details"
from_user = raw_input("User id: ")
to_user = raw_input("Buddy id: ")


print """Connecting to server..."""



socketOut.sendall('@@@'+from_user+'##'+to_user)     # user details and response
response = socketOut.recv(port number)

def listener():
    while 1:
        time.sleep(5)
        socketOut.sendall('$$$'+from_user)
        response = socketOut.recv(8192)
        if response != " ":
            print "\n" + response


if response == 'AUTH_OK':
    data = ""
    th = threading.Thread(target=listener)
    th.setDaemon(1)
    th.start()
    print "Background started"
    while 1:

        if msvcrt.kbhit():
            ch = msvcrt.getche()
        else:
            ch = None
        if ch:
            if ch != '\r':
                data += ch
            else:
                print '\n'
                socketOut.sendall('###'+from_user+'##'+data)
                response = socketOut.recv(8192)
                if response != " ":
                    print response
                data = ""

else:
    print "Ooops...Try Again!!"
        
socketOut.close()
